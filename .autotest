# vi: ft=ruby
require 'autotest'
Autotest.add_discovery do
  (File.directory?('spec') && ENV['RSPEC']) ? "rspec" : "rails"
end

Autotest.add_hook :initialize do |at|
  at.clear_mappings
  # watch out: Ruby bug (1.8.6):
  # %r(/) != /\//
  # TODO Work with Rspec
  at.add_mapping(%r%^test/.*_test.rb$%) { |filename, _| 
    filename 
  }
  at.add_mapping(%r%^lib/(.*)\.rb$%) { |_, m| 
    ["test/#{m[1]}_test.rb"]
  }
  at.add_mapping(%r{^test/rails_root/\w.*}) do
    at.files_matching(%r{^test/.*_test\.rb$})
  end
  at.add_mapping(%r%^test/test_helper\.rb$%) { 
    at.files_matching %r%^test/.*_test\.rb$%
  }
end

